# This file was auto-generated by scripts/generate_api_client.py
# Do not edit manually - changes will be overwritten on regeneration.
#
# Generated from: openapi.json

from __future__ import annotations

from collections.abc import Mapping
from typing import TYPE_CHECKING, Any, TypeVar, cast

from attrs import define as _attrs_define
from attrs import field as _attrs_field

from ..types import UNSET, Unset

if TYPE_CHECKING:
    from ..models.port_range import PortRange
    from ..models.test_server_config_env import TestServerConfigEnv
    from ..models.test_server_health_check import TestServerHealthCheck


T = TypeVar("T", bound="TestServerConfig")


@_attrs_define
class TestServerConfig:
    """Configuration for a test server.

    Attributes:
        command (str): Command to start the server.
        args (list[str] | Unset): Arguments for the server command.
        env (TestServerConfigEnv | Unset): Environment variables for the server process.
            Values can contain placeholders like {port} which will be substituted.
        working_directory (None | str | Unset): Working directory for the server process.
        port_range (None | PortRange | Unset):
        health_check (None | TestServerHealthCheck | Unset):
        startup_timeout_ms (int | Unset): Maximum time to wait for server startup (in milliseconds). Default: 10000.
        shutdown_timeout_ms (int | Unset): Maximum time to wait for server shutdown (in milliseconds). Default: 5000.
    """

    command: str
    args: list[str] | Unset = UNSET
    env: TestServerConfigEnv | Unset = UNSET
    working_directory: None | str | Unset = UNSET
    port_range: None | PortRange | Unset = UNSET
    health_check: None | TestServerHealthCheck | Unset = UNSET
    startup_timeout_ms: int | Unset = 10000
    shutdown_timeout_ms: int | Unset = 5000
    additional_properties: dict[str, Any] = _attrs_field(init=False, factory=dict)

    def to_dict(self) -> dict[str, Any]:
        from ..models.port_range import PortRange
        from ..models.test_server_health_check import TestServerHealthCheck

        command = self.command

        args: list[str] | Unset = UNSET
        if not isinstance(self.args, Unset):
            args = self.args

        env: dict[str, Any] | Unset = UNSET
        if not isinstance(self.env, Unset):
            env = self.env.to_dict()

        working_directory: None | str | Unset
        if isinstance(self.working_directory, Unset):
            working_directory = UNSET
        else:
            working_directory = self.working_directory

        port_range: dict[str, Any] | None | Unset
        if isinstance(self.port_range, Unset):
            port_range = UNSET
        elif isinstance(self.port_range, PortRange):
            port_range = self.port_range.to_dict()
        else:
            port_range = self.port_range

        health_check: dict[str, Any] | None | Unset
        if isinstance(self.health_check, Unset):
            health_check = UNSET
        elif isinstance(self.health_check, TestServerHealthCheck):
            health_check = self.health_check.to_dict()
        else:
            health_check = self.health_check

        startup_timeout_ms = self.startup_timeout_ms

        shutdown_timeout_ms = self.shutdown_timeout_ms

        field_dict: dict[str, Any] = {}
        field_dict.update(self.additional_properties)
        field_dict.update(
            {
                "command": command,
            }
        )
        if args is not UNSET:
            field_dict["args"] = args
        if env is not UNSET:
            field_dict["env"] = env
        if working_directory is not UNSET:
            field_dict["workingDirectory"] = working_directory
        if port_range is not UNSET:
            field_dict["portRange"] = port_range
        if health_check is not UNSET:
            field_dict["healthCheck"] = health_check
        if startup_timeout_ms is not UNSET:
            field_dict["startupTimeoutMs"] = startup_timeout_ms
        if shutdown_timeout_ms is not UNSET:
            field_dict["shutdownTimeoutMs"] = shutdown_timeout_ms

        return field_dict

    @classmethod
    def from_dict(cls: type[T], src_dict: Mapping[str, Any]) -> T:
        from ..models.port_range import PortRange
        from ..models.test_server_config_env import TestServerConfigEnv
        from ..models.test_server_health_check import TestServerHealthCheck

        d = dict(src_dict)
        command = d.pop("command")

        args = cast(list[str], d.pop("args", UNSET))

        _env = d.pop("env", UNSET)
        env: TestServerConfigEnv | Unset
        if isinstance(_env, Unset):
            env = UNSET
        else:
            env = TestServerConfigEnv.from_dict(_env)

        def _parse_working_directory(data: object) -> None | str | Unset:
            if data is None:
                return data
            if isinstance(data, Unset):
                return data
            return cast(None | str | Unset, data)

        working_directory = _parse_working_directory(d.pop("workingDirectory", UNSET))

        def _parse_port_range(data: object) -> None | PortRange | Unset:
            if data is None:
                return data
            if isinstance(data, Unset):
                return data
            try:
                if not isinstance(data, dict):
                    raise TypeError()
                port_range_type_1 = PortRange.from_dict(data)

                return port_range_type_1
            except (TypeError, ValueError, AttributeError, KeyError):
                pass
            return cast(None | PortRange | Unset, data)

        port_range = _parse_port_range(d.pop("portRange", UNSET))

        def _parse_health_check(data: object) -> None | TestServerHealthCheck | Unset:
            if data is None:
                return data
            if isinstance(data, Unset):
                return data
            try:
                if not isinstance(data, dict):
                    raise TypeError()
                health_check_type_1 = TestServerHealthCheck.from_dict(data)

                return health_check_type_1
            except (TypeError, ValueError, AttributeError, KeyError):
                pass
            return cast(None | TestServerHealthCheck | Unset, data)

        health_check = _parse_health_check(d.pop("healthCheck", UNSET))

        startup_timeout_ms = d.pop("startupTimeoutMs", UNSET)

        shutdown_timeout_ms = d.pop("shutdownTimeoutMs", UNSET)

        test_server_config = cls(
            command=command,
            args=args,
            env=env,
            working_directory=working_directory,
            port_range=port_range,
            health_check=health_check,
            startup_timeout_ms=startup_timeout_ms,
            shutdown_timeout_ms=shutdown_timeout_ms,
        )

        test_server_config.additional_properties = d
        return test_server_config

    @property
    def additional_keys(self) -> list[str]:
        return list(self.additional_properties.keys())

    def __getitem__(self, key: str) -> Any:
        return self.additional_properties[key]

    def __setitem__(self, key: str, value: Any) -> None:
        self.additional_properties[key] = value

    def __delitem__(self, key: str) -> None:
        del self.additional_properties[key]

    def __contains__(self, key: str) -> bool:
        return key in self.additional_properties

# stepflow-api

Generated API client for communicating with Stepflow servers.

> **Note:** This package is auto-generated. Do not edit generated files directly.
> See [Code Generation](#code-generation) for how to update.

## Installation

```bash
pip install stepflow-api
```

## Overview

This package provides:
- **attrs-based models** for all Stepflow API request/response types
- **HTTP client** for making API calls (sync and async)
- **Type-safe interfaces** for workflow execution and component discovery

It is used internally by `stepflow-client` and `stepflow-runtime`. Most users should use those packages instead of `stepflow-api` directly.

## Usage

```python
from stepflow_api import Client
from stepflow_api.models import CreateRunRequest
from stepflow_api.api.run import create_run

client = Client(base_url="http://localhost:7837/api/v1")

# Async API call
response = await create_run.asyncio_detailed(
    client=client,
    body=CreateRunRequest(
        flow_id="...",
        input_=[{"key": "value"}],
    )
)

if response.parsed:
    print(f"Run ID: {response.parsed.run_id}")
```

## Code Generation

This package is generated from the Stepflow server's OpenAPI specification using [openapi-python-client](https://github.com/openapi-generators/openapi-python-client).

The OpenAPI spec (`schemas/openapi.json`) is fetched from a running Stepflow server's `/api/v1/openapi.json` endpoint.

### File Structure

All files are auto-generated:

```
stepflow-api/
├── src/stepflow_api/
│   ├── api/                    # API endpoint functions
│   │   ├── run/                # Run endpoints
│   │   │   ├── create_run.py
│   │   │   ├── get_run.py
│   │   │   └── ...
│   │   ├── flow/               # Flow endpoints
│   │   ├── component/          # Component endpoints
│   │   ├── health/             # Health endpoint
│   │   └── debug/              # Debug endpoints
│   ├── models/                 # Request/response models (attrs classes)
│   │   ├── create_run_request.py
│   │   ├── create_run_response.py
│   │   ├── flow.py
│   │   └── ... (120+ model files)
│   ├── client.py               # HTTP client (Client, AuthenticatedClient)
│   ├── types.py                # Utility types (UNSET, Response)
│   └── errors.py               # Error types
└── ...
```

Each generated file includes a header:
```python
# This file was auto-generated by scripts/generate_api_client.py
# Do not edit manually - changes will be overwritten on regeneration.
```

### Regenerating

When the Rust API changes:

```bash
# Update spec from server AND regenerate
uv run python scripts/generate_api_client.py update-spec --generate

# Then run tests to verify
uv run pytest stepflow-client stepflow-runtime -v
```

Other commands:

```bash
# Regenerate from existing spec (no server needed)
uv run python scripts/generate_api_client.py generate

# Check if generated code is up-to-date (for CI)
uv run python scripts/generate_api_client.py check

# Regenerate from a specific spec file
uv run python scripts/generate_api_client.py generate --from path/to/spec.json
```

### How Generation Works

1. `openapi-python-client` generates the full client from the OpenAPI spec
2. A post-processing step adds "auto-generated" headers to all Python files
3. `ruff` formats the generated code
4. The `api/` and `models/` directories are replaced entirely (old files deleted)

This ensures removed endpoints don't leave dead code behind.

## License

Apache-2.0

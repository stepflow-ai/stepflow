schema: https://stepflow.org/schemas/v1/flow.json
name: LangChain UDF Example
description: Demonstrates using /udf component with self-contained Python code to
  create and execute LangChain runnables dynamically
schemas:
  type: object
  properties:
    input:
      type: object
      properties:
        text:
          type: string
          description: Text to process
    output:
      type: object
      properties:
        text_processing_result:
          type: object
          description: Result from user-defined text processing runnable
steps:
- id: create_text_processor_blob
  component: /builtin/put_blob
  input:
    data:
      input_schema:
        type: object
        properties:
          text:
            type: string
        required:
        - text
      code: "from langchain_core.runnables import RunnableLambda\n\ndef process_text(data):\n\
        \    \"\"\"Custom text processing function created via UDF.\"\"\"\n    text\
        \ = data[\"text\"]\n    words = text.split()\n\n    # Custom processing logic\n\
        \    processed_words = []\n    for word in words:\n        if len(word) >\
        \ 3:\n            processed_words.append(word.upper())\n        else:\n  \
        \          processed_words.append(word.lower())\n\n    return {\n        \"\
        processed_text\": \" \".join(processed_words),\n        \"word_count\": len(words),\n\
        \        \"long_word_count\": sum(1 for w in words if len(w) > 3),\n     \
        \   \"short_word_count\": sum(1 for w in words if len(w) <= 3),\n        \"\
        processed_by\": \"custom_udf_processor\",\n        \"original_length\": len(text)\n\
        \    }\n\nreturn RunnableLambda(process_text)\n"
    blob_type: data
- id: process_text_with_udf
  component: /python/udf
  input:
    blob_id:
      $step: create_text_processor_blob
      path: blob_id
    input:
      text:
        $input: text
output:
  text_processing_result:
    $step: process_text_with_udf
test:
  cases:
  - name: self_contained_udf_example
    input:
      text: This demonstrates self-contained user-defined LangChain runnables!
    output:
      outcome: success
      result:
        text_processing_result:
          processed_text: THIS DEMONSTRATES SELF-CONTAINED USER-DEFINED LANGCHAIN
            RUNNABLES!
          word_count: 6
          long_word_count: 6
          short_word_count: 0
          processed_by: custom_udf_processor
          original_length: 66

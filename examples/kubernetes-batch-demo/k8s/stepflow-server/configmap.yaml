apiVersion: v1
kind: ConfigMap
metadata:
  name: stepflow-server-config
  namespace: stepflow-demo
  labels:
    app: stepflow-server
    component: runtime
data:
  stepflow-config.yml: |
    # Stepflow Runtime Configuration for Kubernetes
    #
    # This configuration routes component execution to k8s pods through Pingora

    plugins:
      # Built-in components for core Stepflow functionality
      builtin:
        type: builtin

      # Kubernetes components via Stepflow load balancer
      k8s_components:
        type: stepflow
        url: "http://stepflow-load-balancer.stepflow-demo.svc.cluster.local:8080"

    routes:
      # Route all /python/* components through load balancer
      # Load balancer handles instance routing via Stepflow-Instance-Id header
      "/python/{*component}":
        - plugin: k8s_components

      # Fallback to built-in components
      "/{*component}":
        - plugin: builtin

    # In-memory state store (single-instance runtime)
    storageConfig:
      type: inMemory

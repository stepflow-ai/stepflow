schema: https://stepflow.org/schemas/v1/flow.json
name: Secret Propagation Test
description: Test that is_secret annotation propagates through variable references

schemas:
  type: object
  properties:
    variables:
      type: object
      properties:
        api_key:
          type: string
          is_secret: true
          description: A secret API key
        temperature:
          type: number
          description: A non-secret temperature value
      required:
        - api_key

steps:
  - id: create_message
    component: /builtin/create_messages
    input:
      user_prompt: "Using API key"
      # The api_key should carry is_secret: true from the variable schema
      metadata:
        api_key: { $variable: "api_key" }
        temperature: { $variable: "temperature" }

output:
  messages: { $step: "create_message", path: "$.messages" }

{"openapi":"3.1.0","info":{"title":"Stepflow API","description":"API for Stepflow flows and runs","contact":{"name":"Ben Chambers"},"license":{"name":"Apache-2.0","identifier":"Apache-2.0"},"version":"0.8.0"},"servers":[{"url":"http://localhost:17837/api/v1","description":"Localhost development server"}],"paths":{"/components":{"get":{"tags":["Component"],"summary":"List all available components from plugins","operationId":"list_components","parameters":[{"name":"includeSchemas","in":"query","description":"Whether to include schemas in the response (default: true)","required":false,"schema":{"type":"boolean"}}],"responses":{"200":{"description":"Components listed successfully","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ListComponentsResponse"}}}},"500":{"description":"Internal server error"}}}},"/flows":{"post":{"tags":["Flow"],"summary":"Store a flow and return its hash","operationId":"store_flow","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/StoreFlowRequest"}}},"required":true},"responses":{"200":{"description":"Flow stored successfully","content":{"application/json":{"schema":{"$ref":"#/components/schemas/StoreFlowResponse"}}}},"400":{"description":"Invalid flow"}}}},"/flows/{flow_id}":{"get":{"tags":["Flow"],"summary":"Get a flow by its ID","operationId":"get_flow","parameters":[{"name":"flow_id","in":"path","description":"Flow ID to retrieve","required":true,"schema":{"type":"string"}}],"responses":{"200":{"description":"Flow retrieved successfully","content":{"application/json":{"schema":{"$ref":"#/components/schemas/FlowResponse"}}}},"404":{"description":"Flow not found"}}},"delete":{"tags":["Flow"],"summary":"Delete a flow by ID","operationId":"delete_flow","parameters":[{"name":"flow_id","in":"path","description":"Flow ID to delete","required":true,"schema":{"type":"string"}}],"responses":{"204":{"description":"Flow deleted successfully"},"404":{"description":"Flow not found"},"409":{"description":"Flow has active runs"}}}},"/health":{"get":{"tags":["health"],"summary":"Check service health","operationId":"health_check","parameters":[{"name":"error","in":"query","description":"Trigger an error for testing error response format","required":false,"schema":{"type":["string","null"]}}],"responses":{"200":{"description":"Service is healthy","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HealthResponse"}}}},"400":{"description":"Bad request - triggered by ?error=bad_request"},"404":{"description":"Not found - triggered by ?error=not_found"},"500":{"description":"Internal server error - triggered by ?error=internal or ?error=stack"}}}},"/runs":{"get":{"tags":["Run"],"summary":"List executions with optional filtering","operationId":"list_runs","parameters":[{"name":"status","in":"query","description":"Filter by execution status","required":false,"schema":{"oneOf":[{"type":"null"},{"$ref":"#/components/schemas/ExecutionStatus"}]}},{"name":"flowName","in":"query","description":"Filter by flow name","required":false,"schema":{"type":["string","null"]}},{"name":"rootRunId","in":"query","description":"Filter to runs under this root (includes the root itself)","required":false,"schema":{"type":["string","null"],"format":"uuid"}},{"name":"parentRunId","in":"query","description":"Filter to direct children of this parent run","required":false,"schema":{"type":["string","null"],"format":"uuid"}},{"name":"maxDepth","in":"query","description":"Maximum depth for hierarchy queries (0 = root only)","required":false,"schema":{"type":["integer","null"],"format":"int32","minimum":0}},{"name":"limit","in":"query","description":"Maximum number of results to return","required":false,"schema":{"type":["integer","null"],"minimum":0}},{"name":"offset","in":"query","description":"Number of results to skip","required":false,"schema":{"type":["integer","null"],"minimum":0}}],"responses":{"200":{"description":"Runs listed successfully","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ListRunsResponse"}}}},"500":{"description":"Internal server error"}}},"post":{"tags":["Run"],"summary":"Create and execute a flow by hash","description":"Supports both single and batch execution:\n- Single input: Executes one run and returns the result directly\n- Multiple inputs: Executes batch and waits for all results","operationId":"create_run","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/CreateRunRequest"}}},"required":true},"responses":{"200":{"description":"Flow run created successfully","content":{"application/json":{"schema":{"$ref":"#/components/schemas/CreateRunResponse"}}}},"400":{"description":"Invalid request"},"404":{"description":"Flow not found"},"500":{"description":"Internal server error"}}}},"/runs/{run_id}":{"get":{"tags":["Run"],"summary":"Get execution details by ID","operationId":"get_run","parameters":[{"name":"run_id","in":"path","description":"Run ID (UUID)","required":true,"schema":{"type":"string","format":"uuid"}}],"responses":{"200":{"description":"Run details retrieved successfully","content":{"application/json":{"schema":{"$ref":"#/components/schemas/RunDetails"}}}},"400":{"description":"Invalid run ID format"},"404":{"description":"Run not found"},"500":{"description":"Internal server error"}}},"delete":{"tags":["Run"],"summary":"Delete a completed execution","operationId":"delete_run","parameters":[{"name":"run_id","in":"path","description":"Run ID (UUID)","required":true,"schema":{"type":"string","format":"uuid"}}],"responses":{"204":{"description":"Run deleted successfully"},"400":{"description":"Invalid run ID format"},"404":{"description":"Run not found"},"409":{"description":"Run still running"},"500":{"description":"Internal server error"}}}},"/runs/{run_id}/cancel":{"post":{"tags":["Run"],"summary":"Cancel a running execution","operationId":"cancel_run","parameters":[{"name":"run_id","in":"path","description":"Run ID (UUID)","required":true,"schema":{"type":"string","format":"uuid"}}],"responses":{"200":{"description":"Run cancelled successfully","content":{"application/json":{"schema":{"$ref":"#/components/schemas/RunSummary"}}}},"400":{"description":"Invalid run ID format"},"404":{"description":"Run not found"},"409":{"description":"Run already completed"},"500":{"description":"Internal server error"}}}},"/runs/{run_id}/flow":{"get":{"tags":["Run"],"summary":"Get the workflow definition for an execution","operationId":"get_run_flow","parameters":[{"name":"run_id","in":"path","description":"Run ID (UUID)","required":true,"schema":{"type":"string","format":"uuid"}}],"responses":{"200":{"description":"Run workflow retrieved successfully","content":{"application/json":{"schema":{"$ref":"#/components/schemas/RunFlowResponse"}}}},"400":{"description":"Invalid run ID format"},"404":{"description":"Run or workflow not found"},"500":{"description":"Internal server error"}}}},"/runs/{run_id}/items":{"get":{"tags":["Run"],"summary":"Get all item results for a run","description":"Returns results for all items in the run, ordered by item index.\nFor single-item runs (item_count=1), returns a single item.","operationId":"get_run_items","parameters":[{"name":"run_id","in":"path","description":"Run ID (UUID)","required":true,"schema":{"type":"string","format":"uuid"}}],"responses":{"200":{"description":"Run items retrieved successfully","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ListItemsResponse"}}}},"400":{"description":"Invalid run ID format"},"404":{"description":"Run not found"},"500":{"description":"Internal server error"}}}},"/runs/{run_id}/steps":{"get":{"tags":["Run"],"summary":"Get step-level execution details for a specific execution","operationId":"get_run_steps","parameters":[{"name":"run_id","in":"path","description":"Run ID (UUID)","required":true,"schema":{"type":"string","format":"uuid"}}],"responses":{"200":{"description":"Run step details retrieved successfully","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ListStepRunsResponse"}}}},"400":{"description":"Invalid run ID format"},"404":{"description":"Run not found"},"500":{"description":"Internal server error"}}}}},"components":{"schemas":{"BlobId":{"type":"string","description":"A SHA-256 hash of the blob content, represented as a hexadecimal string."},"Component":{"type":"string","description":"Identifies a specific plugin and atomic functionality to execute. Use component name for builtins (e.g., 'eval') or path format for plugins (e.g., '/python/udf').","examples":["/builtin/eval","/mcpfs/list_files","/python/udf"]},"ComponentInfo":{"type":"object","required":["component"],"properties":{"component":{"$ref":"#/components/schemas/Component","description":"The component ID."},"description":{"type":["string","null"],"description":"Optional description of the component."},"input_schema":{"oneOf":[{"type":"null"},{"$ref":"#/components/schemas/Schema","description":"The input schema for the component.\n\nCan be any valid JSON schema (object, primitive, array, etc.)."}]},"output_schema":{"oneOf":[{"type":"null"},{"$ref":"#/components/schemas/Schema","description":"The output schema for the component.\n\nCan be any valid JSON schema (object, primitive, array, etc.)."}]}}},"CreateRunRequest":{"type":"object","description":"Request to create/execute a flow.\n\nThe `input` field is always an array of input values:\n- Single-item array `[value]`: Executes one run with `value` as input\n- Multi-item array `[v1, v2, ...]`: Executes multiple runs (batch mode)\n\nThis design avoids ambiguity: to run a workflow with an array as input,\nwrap it in another array: `[[1, 2, 3]]` runs once with input `[1, 2, 3]`.","required":["flowId","input"],"properties":{"flowId":{"$ref":"#/components/schemas/BlobId","description":"The flow hash to execute"},"input":{"type":"array","items":{"$ref":"#/components/schemas/Value"},"description":"Input data for the flow - always an array (one element per run)"},"overrides":{"$ref":"#/components/schemas/WorkflowOverrides","description":"Optional workflow overrides to apply before execution"},"variables":{"type":"object","description":"Optional variables to provide for variable references in the workflow","additionalProperties":{"$ref":"#/components/schemas/Value"},"propertyNames":{"type":"string"}},"maxConcurrency":{"type":["integer","null"],"description":"Maximum concurrency for batch execution (only used when input is an array)","minimum":0}}},"CreateRunResponse":{"type":"object","description":"Response for create run operations","required":["runId","itemCount","status"],"properties":{"runId":{"type":"string","format":"uuid","description":"The run ID (for single runs) or batch ID (for batch runs)"},"itemCount":{"type":"integer","format":"int32","description":"Number of items in this run (1 for single runs, > 1 for batch runs)","minimum":0},"result":{"oneOf":[{"type":"null"},{"$ref":"#/components/schemas/FlowResult","description":"The result of the flow execution (if completed, for single runs only)"}]},"status":{"$ref":"#/components/schemas/ExecutionStatus","description":"The run status"}}},"Diagnostic":{"type":"object","description":"A single diagnostic with its context","required":["message","level","text","ignore"],"properties":{"message":{"$ref":"#/components/schemas/DiagnosticMessage","description":"The diagnostic message and type (boxed to handle varying sizes)"},"level":{"$ref":"#/components/schemas/DiagnosticLevel","description":"The severity level"},"text":{"type":"string","description":"Human-readable message text"},"path":{"$ref":"#/components/schemas/Path","description":"JSON path to the field with the issue"},"ignore":{"type":"boolean","description":"Whether this diagnostic should be ignored by default"}}},"DiagnosticLevel":{"type":"string","description":"Diagnostic level indicating severity and impact","enum":["fatal","error","warning"]},"DiagnosticMessage":{"oneOf":[{"type":"object","required":["stepId","type"],"properties":{"stepId":{"type":"string"},"type":{"type":"string","enum":["duplicateStepId"]}}},{"type":"object","required":["type"],"properties":{"type":{"type":"string","enum":["emptyStepId"]}}},{"type":"object","required":["stepId","type"],"properties":{"stepId":{"type":"string"},"type":{"type":"string","enum":["selfReference"]}}},{"type":"object","required":["referencedStep","type"],"properties":{"fromStep":{"type":["string","null"]},"referencedStep":{"type":"string"},"type":{"type":"string","enum":["undefinedStepReference"]}}},{"type":"object","required":["error","type"],"properties":{"stepId":{"type":["string","null"]},"field":{"type":["string","null"]},"error":{"type":"string"},"type":{"type":"string","enum":["invalidReferenceExpression"]}}},{"type":"object","required":["stepId","field","reason","type"],"properties":{"stepId":{"type":"string"},"field":{"type":"string"},"reason":{"type":"string"},"type":{"type":"string","enum":["invalidFieldAccess"]}}},{"type":"object","required":["stepId","component","error","type"],"properties":{"stepId":{"type":"string"},"component":{"type":"string"},"error":{"type":"string"},"type":{"type":"string","enum":["invalidComponent"]}}},{"type":"object","required":["stepId","type"],"properties":{"stepId":{"type":"string"},"type":{"type":"string","enum":["emptyComponentName"]}}},{"type":"object","required":["stepId","field","violation","type"],"properties":{"stepId":{"type":"string"},"field":{"type":"string"},"violation":{"type":"string"},"type":{"type":"string","enum":["schemaViolation"]}}},{"type":"object","required":["error","type"],"properties":{"error":{"type":"string"},"type":{"type":"string","enum":["invalidSubflowLiteral"]}}},{"type":"object","required":["stepId","type"],"properties":{"stepId":{"type":"string"},"type":{"type":"string","enum":["mockComponent"]}}},{"type":"object","required":["stepId","type"],"properties":{"stepId":{"type":"string"},"type":{"type":"string","enum":["unreachableStep"]}}},{"type":"object","required":["type"],"properties":{"type":{"type":"string","enum":["missingFlowName"]}}},{"type":"object","required":["type"],"properties":{"type":{"type":"string","enum":["missingFlowDescription"]}}},{"type":"object","required":["stepId","field","reason","type"],"properties":{"stepId":{"type":"string"},"field":{"type":"string"},"reason":{"type":"string"},"type":{"type":"string","enum":["unvalidatedFieldAccess"]}}},{"type":"object","required":["variable","context","type"],"properties":{"variable":{"type":"string"},"context":{"type":"string"},"type":{"type":"string","enum":["undefinedVariable"]}}},{"type":"object","required":["variable","context","type"],"properties":{"variable":{"type":"string"},"context":{"type":"string"},"type":{"type":"string","enum":["undefinedRequiredVariable"]}}},{"type":"object","required":["type"],"properties":{"type":{"type":"string","enum":["missingVariableSchema"]}}},{"type":"object","required":["stepId","expected","actual","detail","type"],"properties":{"stepId":{"type":"string"},"expected":{"type":"string"},"actual":{"type":"string"},"detail":{"type":"string"},"type":{"type":"string","enum":["typeMismatch"]}}},{"type":"object","required":["stepId","component","type"],"properties":{"stepId":{"type":"string"},"component":{"type":"string"},"type":{"type":"string","enum":["untypedComponentOutput"]}}},{"type":"object","required":["path","property","type"],"properties":{"stepId":{"type":["string","null"]},"path":{"type":"string"},"property":{"type":"string"},"type":{"type":"string","enum":["unknownPropertyInPath"]}}},{"type":"object","required":["reason","type"],"properties":{"stepId":{"type":["string","null"]},"reason":{"type":"string"},"type":{"type":"string","enum":["typeCheckIndeterminate"]}}},{"type":"object","required":["type"],"properties":{"type":{"type":"string","enum":["noPluginsConfigured"]}}},{"type":"object","required":["type"],"properties":{"type":{"type":"string","enum":["noRoutingRulesConfigured"]}}},{"type":"object","required":["routePath","ruleIndex","plugin","type"],"properties":{"routePath":{"type":"string"},"ruleIndex":{"type":"integer","minimum":0},"plugin":{"type":"string"},"type":{"type":"string","enum":["invalidRouteReference"]}}},{"type":"object","required":["plugin","type"],"properties":{"plugin":{"type":"string"},"type":{"type":"string","enum":["unusedPlugin"]}}}],"description":"Specific diagnostic message with context"},"Diagnostics":{"type":"object","description":"Collection of diagnostics with utility methods","required":["diagnostics","numFatal","numError","numWarning"],"properties":{"diagnostics":{"type":"array","items":{"$ref":"#/components/schemas/Diagnostic"},"description":"All diagnostics found"},"numFatal":{"type":"integer","format":"int32","minimum":0},"numError":{"type":"integer","format":"int32","minimum":0},"numWarning":{"type":"integer","format":"int32","minimum":0}}},"ErrorAction":{"oneOf":[{"$ref":"#/components/schemas/OnErrorFail"},{"$ref":"#/components/schemas/OnErrorDefault"},{"$ref":"#/components/schemas/OnErrorRetry"}],"description":"Error action determines what happens when a step fails.","discriminator":{"propertyName":"action","mapping":{"fail":"#/components/schemas/OnErrorFail","retry":"#/components/schemas/OnErrorRetry","useDefault":"#/components/schemas/OnErrorDefault"}}},"ExampleInput":{"type":"object","description":"An example input for a workflow that can be used in UI dropdowns.","required":["name","input"],"properties":{"name":{"type":"string","description":"Name of the example input for display purposes."},"description":{"type":["string","null"],"description":"Optional description of what this example demonstrates."},"input":{"$ref":"#/components/schemas/Value","description":"The input data for this example."}}},"ExecutionStatus":{"type":"string","description":"Status of a workflow execution","enum":["running","completed","failed","cancelled","paused"]},"Flow":{"type":"object","description":"A workflow consisting of a sequence of steps and their outputs.\n\nA flow represents a complete workflow that can be executed. It contains:\n- A sequence of steps to execute\n- Named outputs that can reference step outputs\n\nFlows should not be cloned. They should generally be stored and passed as a\nreference or inside an `Arc`.","properties":{"name":{"type":["string","null"],"description":"The name of the flow."},"description":{"type":["string","null"],"description":"The description of the flow."},"version":{"type":["string","null"],"description":"The version of the flow."},"schemas":{"$ref":"#/components/schemas/FlowSchema","description":"Consolidated schema information for the flow.\nContains input/output schemas, step output schemas, and shared `$defs`."},"steps":{"type":"array","items":{"$ref":"#/components/schemas/Step"},"description":"The steps to execute for the flow."},"output":{"$ref":"#/components/schemas/ValueExpr","description":"The outputs of the flow, mapping output names to their values."},"test":{"oneOf":[{"type":"null"},{"$ref":"#/components/schemas/TestConfig","description":"Test configuration for the flow."}]},"examples":{"type":["array","null"],"items":{"$ref":"#/components/schemas/ExampleInput"},"description":"Example inputs for the workflow that can be used for testing and UI dropdowns."},"metadata":{"type":"object","description":"Extensible metadata for the flow that can be used by tools and frameworks.","additionalProperties":{},"propertyNames":{"type":"string"}}}},"FlowError":{"type":"object","description":"An error reported from within a flow or step.","required":["code","message"],"properties":{"code":{"type":"integer","format":"int64"},"message":{"type":"string"},"data":{"oneOf":[{"type":"null"},{"$ref":"#/components/schemas/Value"}]}}},"FlowResponse":{"type":"object","description":"Response containing a flow definition and its ID","required":["flow","flowId"],"properties":{"flow":{"$ref":"#/components/schemas/Flow","description":"The flow definition"},"flowId":{"$ref":"#/components/schemas/BlobId","description":"The flow ID"},"allExamples":{"type":"array","items":{"$ref":"#/components/schemas/ExampleInput"},"description":"All available examples (includes both examples and test cases)"}}},"FlowResult":{"oneOf":[{"$ref":"#/components/schemas/FlowResultSuccess"},{"$ref":"#/components/schemas/FlowResultFailed"}],"title":"FlowResult","description":"The results of a step execution.","discriminator":{"propertyName":"outcome","mapping":{"failed":"#/components/schemas/FlowResultFailed","success":"#/components/schemas/FlowResultSuccess"}}},"FlowResultFailed":{"type":"object","title":"FlowResultFailed","description":"The step failed with the given error.","required":["outcome","error"],"properties":{"outcome":{"type":"string","title":"FlowOutcome","default":"failed","enum":["failed"]},"error":{"$ref":"#/components/schemas/FlowError"}}},"FlowResultSuccess":{"type":"object","title":"FlowResultSuccess","description":"The step execution was successful.","required":["outcome","result"],"properties":{"outcome":{"type":"string","title":"FlowOutcome","default":"success","enum":["success"]},"result":{"$ref":"#/components/schemas/Value"}}},"FlowSchema":{"type":"object","description":"Consolidated schema information for a flow.\n\nThis struct contains all schema/type information for the flow in a single location,\nallowing shared `$defs` across all schemas and avoiding duplication.\n\nSerializes as a valid JSON Schema with `type: \"object\"` and flow-specific\nproperties (`input`, `output`, `variables`, `steps`) under the `properties` key.","required":["defs","steps"],"properties":{"defs":{"type":"object","description":"Shared type definitions that can be referenced by other schemas.\nReferences use the format `#/schemas/$defs/TypeName`.","additionalProperties":{"$ref":"#/components/schemas/Schema"},"propertyNames":{"type":"string"}},"input":{"oneOf":[{"type":"null"},{"$ref":"#/components/schemas/Schema","description":"The input schema for the flow."}],"default":null},"output":{"oneOf":[{"type":"null"},{"$ref":"#/components/schemas/Schema","description":"The output schema for the flow."}],"default":null},"variables":{"oneOf":[{"type":"null"},{"$ref":"#/components/schemas/Schema","description":"Schema for workflow variables. This is a JSON Schema object where\nproperties define the available variables and their types."}],"default":null},"steps":{"type":"object","description":"Output schemas for each step, keyed by step ID.\nNote: Step input schemas are not included here as they are\ncomponent metadata, not flow-specific schemas.\nUses IndexMap to preserve insertion order for deterministic serialization.","additionalProperties":{"$ref":"#/components/schemas/Schema"},"propertyNames":{"type":"string"}}}},"HealthQuery":{"type":"object","description":"Health check query parameters","properties":{"error":{"type":["string","null"],"description":"Trigger an error for testing error response format"}}},"HealthResponse":{"type":"object","description":"Health check response","required":["status","timestamp","version"],"properties":{"status":{"type":"string","description":"Service status"},"timestamp":{"type":"string","description":"Timestamp when health was checked (RFC3339 format)"},"version":{"type":"string","description":"Service version"}}},"ItemResult":{"type":"object","description":"A single item result in a multi-item run","required":["itemIndex","status"],"properties":{"itemIndex":{"type":"integer","description":"Item index (0-based)","minimum":0},"status":{"$ref":"#/components/schemas/ExecutionStatus","description":"The status of this item"},"result":{"oneOf":[{"type":"null"},{"$ref":"#/components/schemas/FlowResult","description":"The result of the flow execution for this item (if completed)"}]}}},"ItemStatistics":{"type":"object","description":"Statistics about items in a run.","required":["total","completed","running","failed","cancelled"],"properties":{"total":{"type":"integer","description":"Total number of items in this run.","minimum":0},"completed":{"type":"integer","description":"Number of completed items.","minimum":0},"running":{"type":"integer","description":"Number of currently running items.","minimum":0},"failed":{"type":"integer","description":"Number of failed items.","minimum":0},"cancelled":{"type":"integer","description":"Number of cancelled items.","minimum":0}}},"ListComponentsQuery":{"type":"object","description":"Query parameters for listing components","properties":{"includeSchemas":{"type":"boolean","description":"Whether to include schemas in the response (default: true)"}}},"ListComponentsResponse":{"type":"object","description":"Response for listing components","required":["components"],"properties":{"components":{"type":"array","items":{"$ref":"#/components/schemas/ComponentInfo"},"description":"List of available components"}}},"ListItemsResponse":{"type":"object","description":"Response for listing run items","required":["itemCount","items"],"properties":{"itemCount":{"type":"integer","description":"Total number of items in this run","minimum":0},"items":{"type":"array","items":{"$ref":"#/components/schemas/ItemResult"},"description":"Individual item results ordered by item index"}}},"ListRunsQuery":{"type":"object","description":"Query parameters for listing runs","properties":{"status":{"oneOf":[{"type":"null"},{"$ref":"#/components/schemas/ExecutionStatus","description":"Filter by execution status"}]},"flowName":{"type":["string","null"],"description":"Filter by flow name"},"rootRunId":{"type":["string","null"],"format":"uuid","description":"Filter to runs under this root (includes the root itself)"},"parentRunId":{"type":["string","null"],"format":"uuid","description":"Filter to direct children of this parent run"},"maxDepth":{"type":["integer","null"],"format":"int32","description":"Maximum depth for hierarchy queries (0 = root only)","minimum":0},"limit":{"type":["integer","null"],"description":"Maximum number of results to return","minimum":0},"offset":{"type":["integer","null"],"description":"Number of results to skip","minimum":0}}},"ListRunsResponse":{"type":"object","description":"Response for listing runs","required":["runs"],"properties":{"runs":{"type":"array","items":{"$ref":"#/components/schemas/RunSummary"},"description":"List of run summaries"}}},"ListStepRunsResponse":{"type":"object","description":"Response for listing step runs","required":["steps"],"properties":{"steps":{"type":"object","description":"Dictionary of step run results keyed by step ID","additionalProperties":{"$ref":"#/components/schemas/StepRunResponse"},"propertyNames":{"type":"string"}}}},"OnErrorDefault":{"type":"object","title":"OnErrorDefault","description":"If the step fails, use the `defaultValue` instead.\nIf `defaultValue` is not specified, the step returns null.\nThe default value must be a literal JSON value (not an expression).\nFor dynamic defaults, use `$coalesce` in the consuming expression instead.","required":["action"],"properties":{"action":{"type":"string"},"defaultValue":{"allOf":[]}}},"OnErrorFail":{"type":"object","title":"OnErrorFail","description":"If the step fails, the flow will fail.","required":["action"],"properties":{"action":{"type":"string"}}},"OnErrorRetry":{"type":"object","title":"OnErrorRetry","description":"If the step fails, retry it.","required":["action"],"properties":{"action":{"type":"string"}}},"OverrideType":{"type":"string","description":"The type of override operation to perform.","enum":["merge_patch","json_patch"]},"Path":{"type":"array","items":{"$ref":"#/components/schemas/PathPart"}},"PathPart":{"oneOf":[{"type":"object","required":["String"],"properties":{"String":{"type":"string"}}},{"type":"object","required":["Index"],"properties":{"Index":{"type":"integer","minimum":0}}}]},"RunDetails":{"allOf":[{"$ref":"#/components/schemas/RunSummary"},{"type":"object","required":["inputs"],"properties":{"inputs":{"type":"array","items":{"$ref":"#/components/schemas/Value"},"description":"Input values for each item in this run."},"overrides":{"oneOf":[{"type":"null"},{"$ref":"#/components/schemas/WorkflowOverrides","description":"Optional workflow overrides applied to this run (per-run, not per-item)."}]}}}],"description":"Detailed flow run information including inputs.\n\nNote: Item results are not included here. Use `get_item_results()` to\nfetch item results separately. This design reflects that items are stored\nin a separate table and avoids loading all results when just querying\nrun metadata."},"RunFlowResponse":{"type":"object","description":"Response containing a flow definition and its hash for run endpoints","required":["flow","flowId"],"properties":{"flow":{"$ref":"#/components/schemas/Flow","description":"The flow definition"},"flowId":{"$ref":"#/components/schemas/BlobId","description":"The flow hash"}}},"RunSummary":{"type":"object","description":"Summary information about a flow run.","required":["runId","flowId","status","createdAt","rootRunId"],"properties":{"runId":{"type":"string","format":"uuid"},"flowId":{"$ref":"#/components/schemas/BlobId"},"flowName":{"type":["string","null"]},"status":{"$ref":"#/components/schemas/ExecutionStatus"},"items":{"$ref":"#/components/schemas/ItemStatistics","description":"Statistics about items in this run."},"createdAt":{"type":"string","format":"date-time"},"completedAt":{"type":["string","null"],"format":"date-time"},"rootRunId":{"type":"string","format":"uuid","description":"Root run ID for this execution tree.\n\nFor top-level runs, this equals `run_id`.\nFor sub-flows, this is the original run that started the tree."},"parentRunId":{"type":["string","null"],"format":"uuid","description":"Parent run ID if this is a sub-flow.\n\nNone for top-level runs, Some(parent_id) for sub-flows."}}},"Schema":{"type":"object","description":"A valid JSON Schema object."},"Step":{"type":"object","description":"A step in a workflow that executes a component with specific arguments.\n\nNote: Step output schemas are stored in the flow's `types.steps` field,\nnot on individual steps. This allows for shared `$defs` and avoids duplication.","required":["id","component"],"properties":{"id":{"type":"string","description":"Identifier for the step"},"component":{"$ref":"#/components/schemas/Component","description":"The component to execute in this step"},"onError":{"oneOf":[{"type":"null"},{"$ref":"#/components/schemas/ErrorAction"}]},"input":{"$ref":"#/components/schemas/ValueExpr","description":"Arguments to pass to the component for this step"},"mustExecute":{"type":["boolean","null"],"description":"If true, this step must execute even if its output is not used by the workflow output.\nUseful for steps with side effects (e.g., writing to databases, sending notifications)."},"metadata":{"type":"object","description":"Extensible metadata for the step that can be used by tools and frameworks.","additionalProperties":{},"propertyNames":{"type":"string"}}}},"StepOverride":{"type":"object","description":"Override specification for a single step.\n\nContains the override type (merge patch, json patch, etc.) and the value\nto apply. The type field uses `$type` to avoid collisions with step properties.","required":["value"],"properties":{"$type":{"$ref":"#/components/schemas/OverrideType","description":"The type of override to apply. Defaults to \"merge_patch\" if not specified."},"value":{"description":"The override value to apply, interpreted based on the override type."}}},"StepRunResponse":{"type":"object","description":"Response for step run details","required":["stepIndex","stepId","status"],"properties":{"stepIndex":{"type":"integer","description":"Step index in the flow","minimum":0},"stepId":{"type":"string","description":"Step ID"},"component":{"type":["string","null"],"description":"Component name/URL that this step executes"},"status":{"$ref":"#/components/schemas/StepStatus","description":"Current status of the step"},"result":{"oneOf":[{"type":"null"},{"$ref":"#/components/schemas/FlowResult","description":"The result of the step execution (if completed)"}]}}},"StepStatus":{"type":"string","description":"Status of an individual step within a workflow","enum":["blocked","runnable","running","completed","skipped","failed"]},"StoreFlowRequest":{"type":"object","description":"Request to store a flow","required":["flow"],"properties":{"flow":{"$ref":"#/components/schemas/Flow","description":"The flow to store"},"dryRun":{"type":"boolean","description":"If true, only validate the flow without storing it"}}},"StoreFlowResponse":{"type":"object","description":"Response when a flow is stored","required":["diagnostics"],"properties":{"flowId":{"oneOf":[{"type":"null"},{"$ref":"#/components/schemas/BlobId","description":"The ID of the stored flow (only present if no fatal diagnostics)"}]},"diagnostics":{"$ref":"#/components/schemas/Diagnostics","description":"Validation diagnostics"}}},"TestCase":{"type":"object","description":"A single test case for a workflow.","required":["name","input"],"properties":{"name":{"type":"string","description":"Unique identifier for the test case."},"description":{"type":["string","null"],"description":"Optional description of what this test case verifies."},"input":{"$ref":"#/components/schemas/Value","description":"Input data for the workflow in this test case."},"output":{"oneOf":[{"type":"null"},{"$ref":"#/components/schemas/FlowResult","description":"Expected output from the workflow for this test case."}]}}},"TestConfig":{"type":"object","description":"Configuration for testing a workflow.","properties":{"servers":{"type":"object","description":"Test servers to start before running tests.\nKey is the server name, value is the server configuration.","additionalProperties":{"$ref":"#/components/schemas/TestServerConfig"},"propertyNames":{"type":"string"}},"config":{"description":"Stepflow configuration specific to tests.\nCan reference server URLs using placeholders like {server_name.url}."},"cases":{"type":"array","items":{"$ref":"#/components/schemas/TestCase"},"description":"Test cases for the workflow."}}},"TestServerConfig":{"type":"object","description":"Configuration for a test server.","required":["command"],"properties":{"command":{"type":"string","description":"Command to start the server."},"args":{"type":"array","items":{"type":"string"},"description":"Arguments for the server command."},"env":{"type":"object","description":"Environment variables for the server process.\nValues can contain placeholders like {port} which will be substituted.","additionalProperties":{"type":"string"},"propertyNames":{"type":"string"}},"workingDirectory":{"type":["string","null"],"description":"Working directory for the server process."},"portRange":{"type":["array","null"],"items":false,"prefixItems":[{"type":"integer","format":"int32","minimum":0},{"type":"integer","format":"int32","minimum":0}],"description":"Port range for automatic port allocation.\nIf not specified, a random available port will be used."},"healthCheck":{"oneOf":[{"type":"null"},{"$ref":"#/components/schemas/TestServerHealthCheck","description":"Health check configuration."}]},"startupTimeoutMs":{"type":"integer","format":"int64","description":"Maximum time to wait for server startup (in milliseconds).","default":10000,"minimum":0},"shutdownTimeoutMs":{"type":"integer","format":"int64","description":"Maximum time to wait for server shutdown (in milliseconds).","default":5000,"minimum":0}}},"TestServerHealthCheck":{"type":"object","description":"Health check configuration for test servers.","required":["path"],"properties":{"path":{"type":"string","description":"Path for health check endpoint (e.g., \"/health\")."},"timeoutMs":{"type":"integer","format":"int64","description":"Timeout for health check requests (in milliseconds).","default":5000,"minimum":0},"retryAttempts":{"type":"integer","format":"int32","description":"Number of retry attempts for health checks.","default":3,"minimum":0},"retryDelayMs":{"type":"integer","format":"int64","description":"Delay between retry attempts (in milliseconds).","default":1000,"minimum":0}}},"Value":{"allOf":[],"description":"Any JSON value (object, array, string, number, boolean, or null)"},"ValueExpr":{"oneOf":[{"type":"object","title":"StepRef","description":"Step reference: { $step: \"step_id\", path?: \"...\" }","required":["$step"],"properties":{"$step":{"type":"string"},"path":{"type":"string","description":"JSONPath expression"}},"additionalProperties":false},{"type":"object","title":"InputRef","description":"Workflow input reference: { $input: \"path\" }","required":["$input"],"properties":{"$input":{"type":"string","description":"JSONPath expression"}},"additionalProperties":false},{"type":"object","title":"VariableRef","description":"Variable reference: { $variable: \"path\", default?: ValueExpr }","required":["$variable"],"properties":{"$variable":{"type":"string","description":"JSONPath expression including variable name"},"default":{"$ref":"#/components/schemas/ValueExpr"}},"additionalProperties":false},{"type":"object","title":"LiteralExpr","description":"Escaped literal: { $literal: any }","required":["$literal"],"properties":{"$literal":{"allOf":[]}},"additionalProperties":false},{"type":"object","title":"If","description":"Conditional: { $if: condition, then: expr, else?: expr }","required":["$if","then"],"properties":{"$if":{"$ref":"#/components/schemas/ValueExpr"},"then":{"$ref":"#/components/schemas/ValueExpr"},"else":{"$ref":"#/components/schemas/ValueExpr"}},"additionalProperties":false},{"type":"object","title":"Coalesce","description":"Coalesce: { $coalesce: [expr1, expr2, ...] }","required":["$coalesce"],"properties":{"$coalesce":{"type":"array","items":{"$ref":"#/components/schemas/ValueExpr"}}},"additionalProperties":false},{"type":"array","title":"ArrayExpr","items":{"$ref":"#/components/schemas/ValueExpr"},"description":"Array of expressions"},{"type":"object","title":"ObjectExpr","description":"Object with expression values","additionalProperties":{"$ref":"#/components/schemas/ValueExpr"}},{"oneOf":[{"type":"null"},{"type":"boolean"},{"type":"number"},{"type":"string"}],"title":"PrimitiveValue","description":"Literal primitive value"}],"description":"A value expression that can contain literal data or references to other values"},"WorkflowOverrides":{"type":"object","description":"Workflow overrides that can be applied to modify step behavior at runtime.\n\nOverrides are keyed by step ID and contain merge patches or other transformation\nspecifications to modify step properties before execution.","required":["steps"],"properties":{"steps":{"type":"object","description":"Map of step ID to override specification","additionalProperties":{"$ref":"#/components/schemas/StepOverride"},"propertyNames":{"type":"string"}}}}}},"tags":[{"name":"Component","description":"Component API endpoints"},{"name":"Flow","description":"Flow API endpoints"},{"name":"Run","description":"Run API endpoints"}]}
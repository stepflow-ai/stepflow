schema: https://stepflow.org/schemas/v1/flow.json
schemas:
  type: object
  properties:
    input:
      type: object
      properties:
        pattern:
          type: string
        text:
          type: string
    output:
      type: object
      properties:
        pattern_matches:
          type: array
        sentiment_score:
          type: number
        word_analysis:
          type: object
steps:
- id: create_word_analysis_blob
  component: /builtin/put_blob
  input:
    data:
      input_schema:
        type: object
        properties:
          text:
            type: string
        required:
        - text
      code: "text = input['text'].lower()\nwords = text.split()\n\nword_count = len(words)\n\
        char_count = len(text.replace(' ', ''))\n\n# Count word lengths\nword_lengths\
        \ = {}\nfor word in words:\n    length = len(word)\n    word_lengths[length]\
        \ = word_lengths.get(length, 0) + 1\n\n# Find most common words\nword_freq\
        \ = {}\nfor word in words:\n    word_freq[word] = word_freq.get(word, 0) +\
        \ 1\n\nmost_common = sorted(word_freq.items(), key=lambda x: x[1], reverse=True)[:3]\n\
        \nreturn {\n    'word_count': word_count,\n    'char_count': char_count,\n\
        \    'avg_word_length': round(char_count / word_count, 2) if word_count >\
        \ 0 else 0,\n    'word_length_distribution': word_lengths,\n    'most_common_words':\
        \ [{'word': word, 'count': count} for word, count in most_common]\n}\n"
    blob_type: data
- id: create_pattern_search_blob
  component: /builtin/put_blob
  input:
    data:
      input_schema:
        type: object
        properties:
          text:
            type: string
          pattern:
            type: string
        required:
        - text
        - pattern
      code: "text = input['text']\npattern = input['pattern']\n\ntry:\n    matches\
        \ = re.findall(pattern, text)\n    return [{'match': match, 'index': i} for\
        \ i, match in enumerate(matches)]\nexcept:\n    return []\n"
    blob_type: data
- id: create_sentiment_analysis_blob
  component: /builtin/put_blob
  input:
    data:
      input_schema:
        type: object
        properties:
          text:
            type: string
        required:
        - text
      code: "# Simple sentiment analysis based on positive/negative words\npositive_words\
        \ = ['good', 'great', 'excellent', 'amazing', 'wonderful', 'fantastic', 'love',\
        \ 'like', 'happy', 'joy']\nnegative_words = ['bad', 'terrible', 'awful', 'horrible',\
        \ 'hate', 'dislike', 'sad', 'angry', 'upset', 'disappointed']\n\ntext = input['text'].lower()\n\
        words = text.split()\n\npositive_count = sum(1 for word in words if word in\
        \ positive_words)\nnegative_count = sum(1 for word in words if word in negative_words)\n\
        \ntotal_sentiment_words = positive_count + negative_count\nif total_sentiment_words\
        \ == 0:\n    return 0.0  # Neutral\n\n# Return score between -1 (very negative)\
        \ and 1 (very positive)\nsentiment_score = (positive_count - negative_count)\
        \ / total_sentiment_words\nreturn round(sentiment_score, 2)\n"
    blob_type: data
- id: word_analysis
  component: /python/udf
  input:
    blob_id:
      $step: create_word_analysis_blob
      path: blob_id
    input:
      text:
        $input: text
- id: pattern_search
  component: /python/udf
  input:
    blob_id:
      $step: create_pattern_search_blob
      path: blob_id
    input:
      text:
        $input: text
      pattern:
        $input: pattern
- id: sentiment_analysis
  component: /python/udf
  input:
    blob_id:
      $step: create_sentiment_analysis_blob
      path: blob_id
    input:
      text:
        $input: text
output:
  word_analysis:
    $step: word_analysis
  pattern_matches:
    $step: pattern_search
  sentiment_score:
    $step: sentiment_analysis
test:
  cases:
  - name: process positive text with word pattern
    input:
      text: This is a great example of text processing. I love how flexible this system
        is!
      pattern: \b\w{4,}\b
    output:
      outcome: success
      result:
        pattern_matches:
        - index: 0
          match: This
        - index: 1
          match: great
        - index: 2
          match: example
        - index: 3
          match: text
        - index: 4
          match: processing
        - index: 5
          match: love
        - index: 6
          match: flexible
        - index: 7
          match: this
        - index: 8
          match: system
        sentiment_score: 1.0
        word_analysis:
          avg_word_length: 4.33
          char_count: 65
          most_common_words:
          - count: 2
            word: this
          - count: 1
            word: is
          - count: 1
            word: a
          word_count: 15
          word_length_distribution:
            '1': 2
            '11': 1
            '2': 2
            '3': 2
            '4': 4
            '5': 1
            '6': 1
            '7': 1
            '8': 1
  - name: process negative text with specific word pattern
    input:
      text: The weather today is terrible and I hate it. This is awful!
      pattern: \b(weather|today|terrible|hate|awful)\b
    output:
      outcome: success
      result:
        pattern_matches:
        - index: 0
          match: weather
        - index: 1
          match: today
        - index: 2
          match: terrible
        - index: 3
          match: hate
        - index: 4
          match: awful
        sentiment_score: -1.0
        word_analysis:
          avg_word_length: 4.0
          char_count: 48
          most_common_words:
          - count: 2
            word: is
          - count: 1
            word: the
          - count: 1
            word: weather
          word_count: 12
          word_length_distribution:
            '1': 1
            '2': 2
            '3': 3
            '4': 2
            '5': 1
            '6': 1
            '7': 1
            '8': 1

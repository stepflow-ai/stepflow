schema: https://stepflow.org/schemas/v1/flow.json
name: Simple Metadata Test
description: Test flow and step metadata access
version: 1.0.0
metadata:
  flow_type: test_workflow
input_schema:
  type: object
  properties:
    message:
      type: string
      default: hello
steps:
- id: create_metadata_reader
  component: /builtin/put_blob
  metadata:
    step_purpose: udf_creation
  input:
    data:
      input_schema:
        type: object
        properties:
          message:
            type: string
      code: "async def get_metadata_info(input, context):\n  # Get metadata for current\
        \ step (context will provide the step_id automatically)\n  metadata_result\
        \ = await context.get_metadata()\n\n  return {\n    'input_message': input['message'],\n\
        \    'flow_metadata': metadata_result.get('flow_metadata', {}),\n    'step_metadata':\
        \ metadata_result.get('step_metadata'),\n    'context_step_id': context.step_id\n\
        \  }\n\nget_metadata_info\n"
    blob_type: data
- id: first_metadata_step
  component: /python/udf
  metadata:
    step_purpose: first_execution
    execution_order: 1
  input:
    blob_id:
      $step: create_metadata_reader
      path: blob_id
    input:
      message:
        $input: message
- id: second_metadata_step
  component: /python/udf
  metadata:
    step_purpose: second_execution
    execution_order: 2
    extra_info: additional_data
  input:
    blob_id:
      $step: create_metadata_reader
      path: blob_id
    input:
      message:
        $input: message
output:
  first_step_result:
    $step: first_metadata_step
  second_step_result:
    $step: second_metadata_step
test:
  cases:
  - name: simple metadata access test
    input:
      message: test-input
    output:
      outcome: success
      result:
        first_step_result:
          input_message: test-input
          flow_metadata:
            flow_type: test_workflow
          step_metadata:
            step_purpose: first_execution
            execution_order: 1
          context_step_id: first_metadata_step
        second_step_result:
          input_message: test-input
          flow_metadata:
            flow_type: test_workflow
          step_metadata:
            step_purpose: second_execution
            execution_order: 2
            extra_info: additional_data
          context_step_id: second_metadata_step
